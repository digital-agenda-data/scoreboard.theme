<div id="portal-breadcrumbs"
     tal:define="breadcrumbs view/breadcrumbs;
                 req request/URL;
                 dataset_page python:'datasets' in req and not any(x in req for x in ['charts', 'indicators', 'visualizations']);
                 indicators_page python: 'indicators' in req;
                 ind_or_dataset python: dataset_page or indicators_page ">
  <ul class="breadcrumbs">
    <li class="first"><a tal:attributes="href view/navigation_root_url">
      <span class="glyphicon glyphicon-home" aria-hidden="true"></span> Home
    </a></li>
    <li tal:condition="python: 'search' in req">Search</li>
    <li tal:condition="python: 'login' in req">Login</li>
    <tal:block tal:repeat="crumb breadcrumbs">
      <tal:item tal:define="is_last repeat/crumb/end;
        is_vis python:here.meta_type == 'ScoreboardVisualization';
        related_items python:getattr(here, 'getRelatedItems', lambda: None)();
        url crumb/absolute_url;
        title crumb/Title">
        <li tal:condition="python:is_last and related_items">
          <a tal:attributes="href python:related_items[0].absolute_url() + '/visualizations'"
             tal:content="python:related_items[0].title_or_id()">Cube title</a>
        </li>
        <li tal:condition="python:is_last"
            tal:attributes="id string:breadcrumbs-${repeat/crumb/number}">
          <a tal:condition="not: is_vis"
             tal:attributes="href python:url + '/visualizations'"
             tal:content="title">Crumb</a>
          <span tal:condition="is_vis"
                tal:content="title"></span>
        </li>

        <tal:ind_or_dataset condition="python:is_last and ind_or_dataset">
          <li tal:condition="indicators_page">Indicators</li>
          <li tal:condition="dataset_page">Metadata and download</li>
        </tal:ind_or_dataset>
      </tal:item>
    </tal:block>
  </ul>
</div>
