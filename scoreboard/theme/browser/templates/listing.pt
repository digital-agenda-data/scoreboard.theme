<html metal:use-macro="here/main_template/macros/master"
  i18n:domain="plone">
  <div metal:fill-slot="main"
    tal:define="cube nocall:here;
                normalizeString nocall:context/plone_utils/normalizeString;
                isAnon context/@@plone_portal_state/anonymous;
                canModify python:checkPermission('Modify portal content', cube);">
    <div id="homepage-listing" class="scoreboard-listing bootstrap">
      <h1>Digital Agenda Scoreboard</h1>
      <div style="clear:both"></div>
      <div class="listing-description">
        The Scoreboard assesses progress with respect to the targets set out in the Digital Agenda. In addition, it provides analysis and detailed data on all the policy areas covered by the Digital Agenda.
      </div>
      <h2>Please select one of the available datasets:</h2>


      <tal:block define="cubes view/getDataCubes">
        <p tal:condition="not:cubes">
          No Data Cubes.
        </p>
        <div tal:condition="canModify" class="pull-left">
          <a class="btn btn-mini btn-primary" tal:attributes="href string:${here/absolute_url}/addDataCube"><i class="icon-plus-sign icon-white"></i> Add new</a>
        </div>
        <div style="clear: both;"></div>
        <br />
        <table class="scoreboard-datacubes-listing">
          <tal:row repeat="cube cubes">
          <tr class="scoreboard-datacubes-listing-item" tal:attributes="
            id cube/getId;
            data-name cube/getId;
            data-parent python:cube.getParentNode().absolute_url()"
            tal:define="state python:view.getItemState(cube)">
            <td tal:define="has_thumbnail python:hasattr(cube, 'thumbnail')">
              <a tal:attributes="href string:${cube/absolute_url}/visualizations">
                <img tal:condition="has_thumbnail" tal:define="scale cube/@@images"
                     tal:replace="structure python: scale.scale('thumbnail', width=221, height=171, direction='down').tag()" />
                <img tal:condition="not:has_thumbnail" src="++resource++scoreboard.theme.images/connect_thumbnail.png" />
              </a>
            </td>
            <td>
              <a tal:attributes="href string:${cube/absolute_url}/visualizations">
                <h3><span tal:replace="repeat/cube/number"/>. <span tal:replace="python:cube.getExtended_title() or cube.title_or_id()"/></h3>
              </a>
              <p tal:content="structure cube/getSummary"></p>
              <ul class="linklist">
                <li tal:condition="not:isAnon">
                  <span>Status:</span>
                  <span tal:content="state" class="label label-success" tal:condition="python: state == 'published'">STATE</span>
                  <span tal:content="state" class="label label-inverse" tal:condition="python: state == 'private'">STATE</span>
                </li>
                <li><a tal:attributes="href string:${cube/absolute_url}/indicators">
                  Consult the list of indicators, their definition and sources</a></li>
                <li><a tal:attributes="href string:${cube/absolute_url}">
                  Download the original datasets</a></li>
              </ul>
              <div class="dataset-manage" tal:condition="canModify">
                <a class="btn btn-mini btn-warning" tal:attributes="href string:${cube/absolute_url}/edit"><i class="icon-edit icon-white"></i> Edit</a>
                <a class="btn btn-mini btn-danger" tal:attributes="href string:${cube/absolute_url}/delete_confirmation"><i class="icon-trash icon-white"></i> Delete</a>
                <a class="btn btn-mini btn-success" tal:condition="python: state != 'published'"
                  tal:attributes="href string:${cube/absolute_url}/content_status_modify?workflow_action=publish"><i class="icon-ok icon-white"></i> Publish</a>
                <a class="btn btn-mini btn-inverse" tal:condition="python: state != 'private'"
                  tal:attributes="href string:${cube/absolute_url}/content_status_modify?workflow_action=retract"><i class="icon-remove icon-white"></i> Unpublish</a>
              </div>
            </td>
          </tr>
          </tal:row>
        </table>
      </tal:block>
    </div>
  </div>
</html>

